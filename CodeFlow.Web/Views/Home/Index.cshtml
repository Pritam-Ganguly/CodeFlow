@model CodeFlow.Web.Models.HomeViewModel

@{
    ViewData["Title"] = "CodeFlow - Home Page";
    var searchQuery = ViewData["SearchQuery"] as string ?? string.Empty;
    var totalPages = (Model.TotalQuestion / Model.PageSize) + ((Model.TotalQuestion % Model.PageSize == 0) ? 0 : 1);
    bool emptySearchResult = Model.IsSearchResult && !Model.Questions.Any();
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3>
            @if (!Model.IsSearchResult)
            {   
                @:All Questions
            }
            else
            {
                @:Search Results for: @Model.SearchTerm
            }
        </h3>
        @if (!emptySearchResult)
        {
            <div>
                @if (!User.Identity!.IsAuthenticated)
                {
                    <a class="btn btn-primary " asp-controller="Account" asp-action="Login"><i class="fa-solid fa-pen-clip"></i></a>
                }
                else
                {

                    <a class="btn btn-primary" asp-controller="Questions" asp-action="Create"><i class="fa-solid fa-pen-clip"></i></a>
                }
            </div>
        }
    </div>

    @if (emptySearchResult)
    {
        <div class="alert alert-info">
            No questions found matching your search criteria.
        </div>
    }
    else
    {
        <div class="d-flex justify-content-between align-items-center mb-4 flex-row-reverse gap-2">
            <form asp-action="Index" asp-asp-controller="Home" method="get">
                <span><i class="fa-solid fa-filter"></i> </span>
                <select asp-for="SortType" class="s-pagination--item">
                    <option value="0" selected="@(Model.SortType == 0)">Newest</option>
                    <option value="1" selected="@(Model.SortType == 1)">Oldest</option>
                    <option value="2" selected="@(Model.SortType == 2)">Score</option>
                </select>
                <input type="hidden" name="search" value="@Model.SearchTerm" />
                <button class="s-pagination--item js-pagination-item primary-submit" type="submit">Filter</button>
            </form>
        </div>
    }

    <div class="list-group">
        @foreach(var question in Model.Questions)
        {
            <div class="list-group-item list-group-item-action card mb-3 border-0 shadow-sm">
                <div class="d-flex w-100 justify-content-between">
                    <h5 class="mb-2 w-75 mb-2">
                        <a asp-controller="Questions" asp-action="details" asp-route-id="@question.Id" class="text-decoration-none fs-6">
                            @question.Title
                        </a>
                    </h5>
                    <small class="text-muted">@question.Score votes</small>
                </div>
                <p class="mb-1">@(question.BodyMarkdown?.Length > 150 ? question.BodyMarkdown.Substring(0, 150) + "..." : question.Body)</p>
                <div class="mt-2 mb-2">
                    @foreach(var tag in question.Tags.Take(3))
                    {
                        <span class="badge bg-primary bg-opacity-10 text-primary border-0 me-1 mb-1 text-decoration-none">@tag.Name</span>
                    }
                    @if(question.Tags.Count > 3)
                    {
                        <span class="badge bg-secondary bg-opacity-10 text-secondary border-0">
                            +@(question.Tags.Count - 3)
                        </span>
                    }
                </div>
                <small class="text-muted">
                    Asked by <strong>@question.User?.DisplayName</strong> on @question.CreatedAt.ToString("MM dd, yyyy")
                </small>
            </div>
        }
    </div>
    <div class="s-pagination d-flex justify-content-between align-items-center mb-4 flex-column gap-2">
        @await Html.PartialAsync("_Pagination", new PaginationViewModel
        {
            PageIndex = Model.PageNumber,
                PageSize = Model.PageSize,
                TotalPages = totalPages,
                SearchTerm = Model.SearchTerm,
                SortType = Model.SortType
                })
    </div>
    @if (!emptySearchResult)
    {
        <div class="s-pagination d-flex justify-content-between align-items-center mb-4 flex-row-reverse gap-2 ">
            <form asp-controller="Home" asp-action="index"
                  method="get"
                  aria-label="Update page size"
                  title="Update Page Size">
                <span><i class="fa-solid fa-list"></i></span>
                <select asp-for="PageSize" class="s-pagination--item">
                    <option value="5" selected="@(Model.PageSize == 5)">5</option>
                    <option value="10" selected="@(Model.PageSize == 10)">10</option>
                    <option value="20" selected="@(Model.PageSize == 20)">20</option>
                </select>
                <input type="hidden" name="search" value="@Model.SearchTerm" />
                <input type="hidden" name="sorttype" value="@Model.SortType" />
                <button class="s-pagination--item js-pagination-item primary-submit" type="submit">Submit</button>
            </form>
        </div>
    }
</div>

@section Styles {
    <style>
        .s-pagination {
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .s-pagination--item {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 32px;
            height: 32px;
            padding: 0 8px;
            border: 1px solid #d6d9dc;
            border-radius: 4px;
            background-color: #ffffff;
            color: #3c4146;
            text-decoration: none;
            font-size: 13px;
            font-weight: 400;
            line-height: 1;
            cursor: pointer;
            transition: all 0.15s ease-in-out;
            position: relative;
        }

            .s-pagination--item:hover {
                background-color: #f8f9f9;
                border-color: #babfc4;
                color: #0c0d0e;
                text-decoration: none;
            }

            .s-pagination--item:focus {
                outline: none;
                box-shadow: 0 0 0 4px rgba(0, 149, 255, 0.15);
                border-color: #f48225;
            }

            .s-pagination--item.is-selected {
                background-color: #f48225;
                border-color: #f48225;
                color: #ffffff;
                font-weight: 700;
                pointer-events: none;
            }

            .s-pagination--item.primary-submit {
                background-color: #f48225;
                border-color: #f48225;
                color: #ffffff;
                font-weight: 700;
            }

                .s-pagination--item.primary-submit:hover {
                    background-color: #f48225;
                    border-color: #ffd6b3;
                    color: #ffffff;
                    font-weight: 700;
                }

            .s-pagination--item.is-disabled {
                background-color: #f8f9f9;
                border-color: #d6d9dc;
                color: #6a737c;
                cursor: not-allowed;
                pointer-events: none;
            }

        .s-pagination--item-icon {
            font-size: 16px;
            line-height: 1;
            margin: 0 2px;
        }

        .s-pagination--item__clear {
            border: none;
            background: transparent;
            pointer-events: none;
            min-width: auto;
            padding: 0 4px;
        }

        .s-pagination--item-icon {
            font-size: 14px;
        }

        .pagination-summary {
            color: #6a737c;
            font-size: 13px;
            margin-bottom: 16px;
        }

            .pagination-summary strong {
                color: #0c0d0e;
            }
    </style>
}
